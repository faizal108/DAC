<!doctype html>
<html>
  <body>
    <canvas
      id="c"
      width="800"
      height="600"
      style="border: 1px solid black"
    ></canvas>

    <script type="module">
      /* Renderer */
      import { CanvasRenderer, ViewTransform, Viewport } from "../src/index.js";

      /* Geometry */
      import {
        createPoint,
        createLine,
      } from "../../core-geometry/src/index.js";

      /* Workspace */
      import {
        Workspace,
        SelectTool,
        LineTool,
      } from "../../core-workspace/src/index.js";

      /* Commands */
      import { CommandManager } from "../../core-commands/src/index.js";

      /* Scene */
      import { Scene } from "../../core-scene/src/index.js";

      /* Canvas */
      const canvas = document.getElementById("c");

      /* Transform */
      const tf = new ViewTransform();

      tf.scale = 40;
      tf.offsetX = 400;
      tf.offsetY = 300;

      /* Renderer */
      const renderer = new CanvasRenderer(canvas, tf);

      /* Viewport */
      const viewport = new Viewport(tf, canvas);

      /* Scene + Commands */
      const scene = new Scene();
      const commands = new CommandManager(scene);

      /* Workspace */
      const ws = new Workspace(canvas, scene, renderer, tf);

      ws.commands = commands;

      /* Default tool */
      ws.tools.set(new SelectTool(ws));

      /* Tool switching */
      window.addEventListener("keydown", (e) => {
        if (e.key === "l") {
          ws.tools.set(new LineTool(ws));
          console.log("Line tool");
        }

        if (e.key === "s") {
          ws.tools.set(new SelectTool(ws));
          console.log("Select tool");
        }
      });

      /* Render loop */
      function loop() {
        renderer.drawAll(scene.getAll());

        const tool = ws.tools.get();

        if (tool?.drawOverlay) {
          tool.drawOverlay(renderer.ctx);
        }

        requestAnimationFrame(loop);
      }

      loop();

      console.log("Workspace ready. Press L (line), S (select)");
    </script>
  </body>
</html>
